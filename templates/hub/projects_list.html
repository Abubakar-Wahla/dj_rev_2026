{% extends "base.html" %}
{% block content %}
<h2>Projects</h2>

<form method="GET" action="">
  <input type="text" name="search" placeholder="Search..." value="{{ request.GET.search }}">
  <button type="submit">Search</button>
  {% if request.GET.search %}
    <a href="{% url 'hub-projects' %}">Clear</a>
  {% endif %}
</form>

<hr>

{% if request.user.is_authenticated %}
  <a href="{% url 'hub-project-create' %}">Create Project</a>
  <hr>
{% endif %}

{% for p in projects %}
  <div>
    <b>{{ p.title }}</b>
    <small>by {{ p.owner.username }}</small>

    {% if request.user == p.owner %}
      | <a href="{% url 'hub-project-edit' p.id %}">Edit</a>
      | <a href="{% url 'hub-project-delete' p.id %}">Delete</a>
    {% endif %}
  </div>

  {% if p.tags.all %}
  <div>
    {% for t in p.tags.all %}
      <a href="?tag={{ t.name }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">
        #{{ t.name }}
      </a>
    {% endfor %}
  </div>
{% endif %}

{% empty %}
  <p>No projects found.</p>
{% endfor %}

<hr>

{% if is_paginated %}
  <div>
    {% if page_obj.has_previous %}
      <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">First</a>
      <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Prev</a>
    {% endif %}

    <span>
      Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Next</a>
      <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Last</a>
    {% endif %}
  </div>
{% endif %}
{% endblock %}
